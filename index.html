<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<!-- "width=device-width":把布局视口的像素等同于设备独立像素 -->
		<!-- viewport:布局视口为理想视口,它的css像素等于设备独立像素 -->
		<!-- "initial-scale=1.0":系统缩放参照理想视口改变布局视口和视觉视口 -->
		<!-- 产生冲突时,哪个视口大,就为窗口的数据 -->
		<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no,minimum-scale=1.0,maximum-scale=1.0"/>
		<title></title>
		<link rel="stylesheet" type="text/css" href="./css/tai.css"/>
		
	</head>
	<body>
		<div id="wrap">
			<div class="scrollBar"></div>
			<!-- 头部 -->
			<div class="head">
				<div class="head-top">
					<!-- logo -->
					<h1 class="logo">
						<a href="https://y.music.163.com/m/">
							<img src="img/logo.png" >
						</a>
					</h1>
					<!-- 面包线导航 -->
					<a href="javascript:;" class="menubtn" @click="changemask"></a>
					<!-- 按钮排 -->
					<div class="btns">
						<a href="javascript:;" class="search">搜索</a>
						<a href="javascript:;">登录</a>
						<a href="javascript:;">注册</a>
					</div>
				</div>
				<div class="head-bottom">
					<form method="post">
						<input type="text" placeholder="请碰我一下" />
						<input type="submit" value="搜索" />
					</form>
				</div>
				<ul class="mask" >
					<li>
						<a href="javascript:;">首页</a>
					</li>
					<li>
						<a href="javascript:;">MV</a>
					</li>
					<li>
						<a href="javascript:;">约旦</a>
					</li>
					<li>
						<a href="javascript:;">v榜</a>
					</li>
					<li>
						<a href="javascript:;">音乐</a>
					</li>
					<li>
						<a href="javascript:;">商城</a>
					</li>
					<li>
						<a href="javascript:;">节目</a>
					</li>
					<li>
						<a href="javascript:;">饭团</a>
					</li>
					<li>
						<a href="javascript:;">咨询</a>
					</li>
					<li>
						<a href="javascript:;">我的家</a>
					</li>
					<li>
						<a href="javascript:;">APP下载</a>
					</li>
					<li>
						<a href="javascript:;">热门应用</a>
					</li>
				</ul>
			</div>
			<!-- 内容 -->
			<div class="content">
				<div class="">
					<!-- 导航 -->
					<div class="damu-nav-drag-wrapper">
						<ul class="list">
							<li>
								<a href="javascript:;" class="active">首页</a>
							</li>
							<li>
								<a href="javascript:;">MV</a>
							</li>
							<li>
								<a href="javascript:;">约旦</a>
							</li>
							<li>
								<a href="javascript:;">v榜</a>
							</li>
							<li>
								<a href="javascript:;">音乐</a>
							</li>
							<li>
								<a href="javascript:;">商城</a>
							</li>
							<li>
								<a href="javascript:;">节目</a>
							</li>
							<li>
								<a href="javascript:;">饭团</a>
							</li>
							<li>
								<a href="javascript:;">咨询</a>
							</li>
							<li>
								<a href="javascript:;">我的家</a>
							</li>
							<li>
								<a href="javascript:;">APP下载</a>
							</li>
							<li>
								<a href="javascript:;">热门应用</a>
							</li>
							<li>
								<a href="javascript:;">直播</a>
							</li>
							<li>
								<a href="javascript:;">影视</a>
							</li>
							<li>
								<a href="javascript:;">综艺</a>
							</li>
							<li>
								<a href="javascript:;">演奏</a>
							</li>
							<li>
								<a href="javascript:;">翻唱</a>
							</li>
						</ul>
						
					</div>
					<!-- 无缝滑屏 -->
					<div class="carousel-wrap" needAuto needCarousel>
						<div class="points-wrap"></div>
					</div>
					<!-- tap选项卡 -->
					<div class="tap-wrap">
						<div class="tap-head">
							<h2>MV主播</h2>
							<span>更多&gt;</span>
						</div>
						<div class="tap-nav">
							<a href="javascript:;">全部</a>
							<a href="javascript:;">内地</a>
							<a href="javascript:;">港台</a>
							<a href="javascript:;">欧美</a>
							<a href="javascript:;">韩国</a>
							<a href="javascript:;">日本</a>
							<div class="sGreen">
								
							</div>
						</div>
						<div class="tap-content">
							<ul class="tap-loading">
								<li></li>
							</ul>
							<ul>
								<li>
									<a href="javascript:;">
										<img src="img/a.jpg" >
										<span>君に贈る花がないがないがないがないがないがないがない</span>
									</a>
									<div class="tap-discuss">
										<div class="right">
											<span></span>
											<span>9176</span>
										</div>
										<div class="left">
											<span></span>
											<span>6</span>
										</div>
									</div>
								</li>
								<li>
									<a href="javascript:;">
										<img src="./img/b.jpg" >
										<span>君に贈る花がないがないがないがないがないがないがない</span>
									</a>
									<div class="tap-discuss">
										<div class="right">
											<span></span>
											<span>9176</span>
										</div>
										<div class="left">
											<span></span>
											<span>6</span>
										</div>
									</div>
								</li>
								<li>
									<a href="javascript:;">
										<img src="./img/c.jpg" >
										<span>君に贈る花がないがないがないがないがないがないがない</span>
									</a>
									<div class="tap-discuss">
										<div class="right">
											<span></span>
											<span>9176</span>
										</div>
										<div class="left">
											<span></span>
											<span>6</span>
										</div>
									</div>
								</li>
								<li>
									<a href="javascript:;">
										<img src="./img/d.jpg" >
										<span>君に贈る花がないがないがないがないがないがないがない</span>
									</a>
									<div class="tap-discuss">
										<div class="right">
											<span></span>
											<span>9176</span>
										</div>
										<div class="left">
											<span></span>
											<span>6</span>
										</div>
									</div>
								</li>
								<li>
									<a href="javascript:;">
										<img src="./img/e.jpg" >
										<span>君に贈る花がないがないがないがないがないがないがない</span>
									</a>
									<div class="tap-discuss">
										<div class="right">
											<span></span>
											<span>9176</span>
										</div>
										<div class="left">
											<span></span>
											<span>6</span>
										</div>
									</div>
								</li>
								<li>
									<a href="javascript:;">
										<img src="./img/f.jpg" >
										<span>君に贈る花がないがないがないがないがないがないがない</span>
									</a>
									<div class="tap-discuss">
										<div class="right">
											<span></span>
											<span>9176</span>
										</div>
										<div class="left">
											<span></span>
											<span>6</span>
										</div>
									</div>
								</li>
							</ul>
							<ul class="tap-loading">
								<li></li>
							</ul>
						</div>
					</div>
					<div class="tap-wrap">
					<div class="tap-head">
						<h2>MV主播</h2>
						<span>更多&gt;</span>
					</div>
					<div class="tap-nav">
						<a href="javascript:;">全部</a>
						<a href="javascript:;">内地</a>
						<a href="javascript:;">港台</a>
						<a href="javascript:;">欧美</a>
						<a href="javascript:;">韩国</a>
						<a href="javascript:;">日本</a>
						<div class="sGreen">
							
						</div>
					</div>
					<div class="tap-content">
						<ul class="tap-loading">
							<li></li>
						</ul>
						<ul>
							<li>
								<a href="javascript:;">
									<img src="img/a.jpg" >
									<span>君に贈る花がないがないがないがないがないがないがない</span>
								</a>
								<div class="tap-discuss">
									<div class="right">
										<span></span>
										<span>9176</span>
									</div>
									<div class="left">
										<span></span>
										<span>6</span>
									</div>
								</div>
							</li>
							<li>
								<a href="javascript:;">
									<img src="./img/b.jpg" >
									<span>君に贈る花がないがないがないがないがないがないがない</span>
								</a>
								<div class="tap-discuss">
									<div class="right">
										<span></span>
										<span>9176</span>
									</div>
									<div class="left">
										<span></span>
										<span>6</span>
									</div>
								</div>
							</li>
							<li>
								<a href="javascript:;">
									<img src="./img/c.jpg" >
									<span>君に贈る花がないがないがないがないがないがないがない</span>
								</a>
								<div class="tap-discuss">
									<div class="right">
										<span></span>
										<span>9176</span>
									</div>
									<div class="left">
										<span></span>
										<span>6</span>
									</div>
								</div>
							</li>
							<li>
								<a href="javascript:;">
									<img src="./img/d.jpg" >
									<span>君に贈る花がないがないがないがないがないがないがない</span>
								</a>
								<div class="tap-discuss">
									<div class="right">
										<span></span>
										<span>9176</span>
									</div>
									<div class="left">
										<span></span>
										<span>6</span>
									</div>
								</div>
							</li>
							<li>
								<a href="javascript:;">
									<img src="./img/e.jpg" >
									<span>君に贈る花がないがないがないがないがないがないがない</span>
								</a>
								<div class="tap-discuss">
									<div class="right">
										<span></span>
										<span>9176</span>
									</div>
									<div class="left">
										<span></span>
										<span>6</span>
									</div>
								</div>
							</li>
							<li>
								<a href="javascript:;">
									<img src="./img/f.jpg" >
									<span>君に贈る花がないがないがないがないがないがないがない</span>
								</a>
								<div class="tap-discuss">
									<div class="right">
										<span></span>
										<span>9176</span>
									</div>
									<div class="left">
										<span></span>
										<span>6</span>
									</div>
								</div>
							</li>
						</ul>
						<ul class="tap-loading">
							<li></li>
						</ul>
					</div>
				</div>
				</div>
			</div>
		</div>
	</body>
	<script src="./js/tools.js"></script>
	<!-- 1rem = 25px -->
	<script src="./js/rem.js" type="text/javascript" charset="utf-8"></script>
	<script src="./js/damu.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript">
		
		window.onload = function(){
			// 全局事件默认行为的禁止
			document.addEventListener("touchstart",function(ev){
				ev = ev || event;
				ev.preventDefault();
			},{passive:false});
			
			// 竖向滑屏
			vMove();
			function vMove(){
				let head = document.querySelector("#wrap .head");
				let content = document.querySelector("#wrap .content");
				let wrap = document.querySelector("#wrap .content > div");
				let bar = document.querySelector("#wrap .scrollBar");
				let scale = document.documentElement.clientHeight / (head.offsetHeight + wrap.offsetHeight);
				bar.style.height = document.documentElement.clientHeight * scale + "px";
				let callback={
					start:function(){
						bar.style.opacity = 1;
					},
					move:function() {
						let scale = damu.css(this,"translateY") / (wrap.offsetHeight - content.clientHeight);
						// scale = 实时距离/最大距离
						damu.css(bar,"translateY",-scale*(document.documentElement.clientHeight - bar.offsetHeight))
					},
					end:function(){
						bar.style.opacity = 0;
					}
				}
				damu.vMove(content,callback);
			}
			
			// 取消右键菜单
			// document.oncontextmenu = function(){
			// 	return false;
			// }
			
			// tap选项卡
			/* 
				一次move过程:
				touchstart事件触发一次
				touchend事件触发N次
				touchmove事件触发一次
				
				1.基本的滑屏逻辑(防抖动)
				2.结合tap选项卡的实际需求 滑屏
				--- 手指一次move过程没有过1/2
						我们不关心touchmove的触发次数
				--- 手指一次move过程过1/2
						0
						-2w
						touchmove的触发次数必须只有一次
				3.一个逻辑只被触发一次
					定时器
						控制一个逻辑在一定时间内被触发一次
					立flag
						控制一个逻辑在一类操作过程中被触发一次
			*/
		  /* 
				超过1/2
				1.一开始loading图是隐藏的,loading图需要出现
				2.发送请求 处理请求 完成数据渲染
					动画(content去0或者-2w位置)完成之后,再去进行这一系列的逻辑
						--- content要回看到-w的位置
				3.
			*/
		  /* 
				存值 存址
				在部分手机的webview上 移动端事件的event对象指向了同一个引用
			*/
			tap();
			function tap(){
				let wrap = document.querySelector("#wrap .content .tap-wrap");
				let contentNodes = document.querySelectorAll("#wrap .content .tap-wrap .tap-content");
				// let loadings = document.querySelectorAll("#wrap .content .tap-wrap .tap-content .tap-loading");
				let w = wrap.offsetWidth;
				 for(let i = 0; i < contentNodes.length; i++){
					 move(contentNodes[i]);
				 }
				 
				 function move(content){
					 // 抽象小绿的下标
					 let now = 0;
					 let sGreen = content.parentNode.querySelector(".tap-nav .sGreen");
					 let aNodes = content.parentNode.querySelectorAll(".tap-nav a");
					 let loadings = document.querySelectorAll(".tap-loading");
					 damu.css(content,"translateX",-w);
					 sGreen.style.width = aNodes[0].offsetWidth + "px";
					 
					 // 手指一开始的位置
					 // let startPoint = {x:0, y:0};
					 let startPoint = {};
					 // 元素一开始的位置
					 let elementPoint = {x:0, y:0}
					 let isX = true;
					 let isFirst = true;
					 
					 // 在1/2跳转时 让整个jump逻辑干干净净地只触发一次
					 let isOver = false;
					 
					 // 滑屏逻辑 content既是滑屏区域,也是滑屏元素
					 content.addEventListener("touchstart",function(ev){
						 // isOver = false;
						 
						 if(isOver){
						 	 return;
						 }
						 ev = ev || event;
						 let touchC = ev.changedTouches[0];
						 // 快照
						 // startPoint = {clientX:touchC.clientX,clientY:touchC.clientY};
						 startPoint = touchC;
						 // startPoint.x = touchC.clientX;
						 // startPoint.y = touchC.clientY;
						 elementPoint.x = damu.css(content,"translateX");
						 elementPoint.y = damu.css(content,"translateY");
						 
						 isX = true;
						 isFirst = true;
						 
						 content.style.transition = "none";
					 })
					 
					 content.addEventListener("touchmove",function(ev){
						 if(!isX){
						 	 return;
						 }
						 if(isOver){
						 	 return;
						 }
					 	 ev = ev || event;
					 	 let touchC = ev.changedTouches[0];
						 
						 let nowPoint = {};
						 let dis = {x:0, y:0};
						 nowPoint = touchC;
						 // nowPoint.y = touchC.clientY;
						 dis.x = nowPoint.clientX - startPoint.clientX;
						 dis.y = nowPoint.clientY - startPoint.clientY;
						 
						 if(isFirst){
							 isFirst = false;
							 if(Math.abs(dis.y) > Math.abs(dis.x)){
								 isX = false;
								 return;
							 }
						 }
						 
						 let translateX = elementPoint.x + dis.x;
						 damu.css(content,"translateX",translateX);
						 
						 // 1/2跳转
						 jump(dis.x);
					 })
					 
					 content.addEventListener("touchend",function(ev){
						  if(isOver){
						 	  return;
						  }
							ev = ev || event;
							let touchC = ev.changedTouches[0];
							
							let nowPoint = {};
							let dis = {x:0};
							nowPoint = touchC;
							dis.x = nowPoint.clientX - startPoint.clientX;
						 
					 		if(Math.abs(dis.x) <= w / 2){
					 			content.style.transition = "1s transform";
					 			damu.css(content,"translateX",-w);
					 			
					 		}				 
					 })
					 
					 // 1/2跳转 --> 请求
					 function jump(disX){
						 if(isOver){
							 return;
						 }
						 if(Math.abs(disX) > w / 2){
							 isOver = true;
							 content.style.transition = "1s transform";
							 let targetX = disX > 0 ? 0 : -2 * w;
							 damu.css(content,"translateX",targetX);
							 
							 // 请求一定要在动画执行完毕之后再发,
							 content.addEventListener("transitionend",endFn);
							 content.addEventListener("webkitTransitionEnd",endFn);
							 
							 function endFn() {
								 // 循环定时器 回调函数的头部第一行清定时器
								 // DOM2 绑定 transitionend事件 回调函数的头部第一行解绑事件
								 content.removeEventListener("transitionend",endFn);
								 content.removeEventListener("webkitTransitionEnd",endFn);
								 content.style.transition = "none";
							 	/* 
									超过1/2
									1.一开始loading图是隐藏的,loading图需要出现(1/2跳转后 请求发送前)
									2.发送请求 处理请求 完成数据渲染
										动画(content去0或者-2w位置)完成之后,再去进行这一系列的逻辑
											--- content要回看到-w的位置 
								*/
							  for(let i = 0; i < loadings.length; i++){
									loadings[i].style.opacity = 1;
								}
								
								// 对now进行控制
								disX > 0 ? now-- : now++;
								if(now < 0){
									now = aNodes.length - 1;
								}else if(now > aNodes.length - 1){
									now = 0;
								}
								damu.css(sGreen,"translateX",aNodes[now].offsetLeft);
								if(aNodes[now].offsetWidth != sGreen.offsetWidth){
									sGreen.style.width = aNodes[now].offsetWidth + "px";
								}
								
								// 发ajax请求 去服务端拿数据(学完node之后发一发)
								// 优雅的处理数据
								setTimeout(function(){
									// 成功 content要回到-w的位置 loading图隐藏
									for(let i = 0; i < loadings.length; i++){
										loadings[i].style.opacity = 0;
									}
									damu.css(content,"translateX",-w);
									
									// 最后一步
									isOver = false;
									
								},2000)
 								
							 }
						 }
					 }
					 
				 }
				 
			}
			
			// 导航点击变色
			changeColor();
			function changeColor(){
				let list = document.querySelector("#wrap .content .damu-nav-drag-wrapper .list");
				let aNodes = document.querySelectorAll("#wrap .content .damu-nav-drag-wrapper .list > li a");
				list.addEventListener("touchstart",function(){
					this.isMove = false;
				})
				
				list.addEventListener("touchmove",function(){
					this.isMove = true;
				})
				list.addEventListener("touchend",function(ev){
					if(this.isMove){
						return;
					}
					ev = ev || event;
					let touchC = ev.changedTouches[0];
					for(let i = 0; i < aNodes.length; i++){
						tools.removeClass(aNodes[i],"active");
					}
					// .nodeName:获取元素的节点名称
					// if(touchC.target.nodeName.toUpperCase() === "A"){
					// 	tools.addClass(touchC.target.parentNode,"active");
					// }else if(touchC.target.nodeName.toUpperCase() === "LI"){
					// 	tools.addClass(touchC.target,"active");
					// }
					
					tools.addClass(touchC.target,"active");
					
				})
				
			}
			
		  // 无缝滑屏
			swiper()
			function swiper(){
				let arr = ["img/1.jpg","img/2.jpg","img/3.jpg","img/4.jpg","img/5.jpg"];
				damu.carousel(arr);
			}
			
			// 可拖拽的导航
			drag();
			function drag(){
				damu.dragNav();
			}
			
			// 光标聚焦
			changFocus();
			function changFocus(){
				const inputText = document.querySelector("#wrap .head .head-bottom form input[type='text']");
				inputText.addEventListener("touchstart",function(ev){
					ev = ev||event;
					this.focus();
					ev.stopPropagation();
					// ev.preventDefault();
				})
				document.addEventListener("touchstart",function(){
					inputText.blur();
				})
			}
			
			// 点击切换菜单按钮
			CMCFMenuBtn();
			function CMCFMenuBtn(){
				let menubtn = document.querySelector("#wrap .head .head-top .menubtn");
				let mask = document.querySelector("#wrap .head .mask");
				//isXX:false  频道按钮
				//isXX:ture	  XX按钮
				let isXX=false;
				menubtn.addEventListener("touchstart",function(ev){
					ev = ev||event;
					const touchC = ev.changedTouches[0];
					if(!isXX){
						tools.addClass(menubtn,"active");
						mask.style.display="block";
					}else{
						tools.removeClass(menubtn,"active");
						mask.style.display="none";
					}
					isXX=!isXX;
					// 停止冒泡
					ev.stopPropagation();
					ev.preventDefault();
				})	
				
				document.addEventListener("touchstart",function(){
					if(isXX){
						tools.removeClass(menubtn,"active");
						mask.style.display="none";
						// 注意一定要同步回来
						isXX=!isXX;
					}
				})
				
				mask.addEventListener("touchstart",function(ev){
					ev = ev || event;
					ev.stopPropagation();
					ev.preventDefault();
				})
				
			}
			
			
		}
	</script>
	
</html>
